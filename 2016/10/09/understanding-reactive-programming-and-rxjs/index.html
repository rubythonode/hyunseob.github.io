<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>[번역] 반응형 프로그래밍과 RxJS 이해하기 | DailyEngineering</title><link rel="stylesheet" href="/libs/spoqa-han-sans/css/SpoqaHanSans-kr.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/libs/normalize.min.css"><link rel="stylesheet" href="/libs/font-awesome-4.6.3/css/font-awesome.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/highlights/dracula.css"><link rel="canonical" href="https://hyunseob.github.io/2016/10/09/understanding-reactive-programming-and-rxjs/"/>
<meta name="description" content="요약: RxJS는 이벤트 스트림과 데이터를 쉽게 만들고 다룰 수 있도록 도우는 라이브러리다. 복잡하지만 가독성이 좋은 비동기적 코드를 더 쉽게 작성할 수 있도록 도운다.

큰 규모의 비동기 어플리케이션을 작성하는 것은 쉬운 일이 아니다. 모두 콜백 헬 이슈를 한 번 쯤은 겪어보았을 것이다. 이런 걱정이 점점 커지면서, 사람들은 스스로 비동기적 JavaScr">
<meta property="og:type" content="article">
<meta property="og:title" content="[번역] 반응형 프로그래밍과 RxJS 이해하기">
<meta property="og:url" content="https://hyunseob.github.io/2016/10/09/understanding-reactive-programming-and-rxjs/index.html">
<meta property="og:site_name" content="DailyEngineering">
<meta property="og:description" content="요약: RxJS는 이벤트 스트림과 데이터를 쉽게 만들고 다룰 수 있도록 도우는 라이브러리다. 복잡하지만 가독성이 좋은 비동기적 코드를 더 쉽게 작성할 수 있도록 도운다.

큰 규모의 비동기 어플리케이션을 작성하는 것은 쉬운 일이 아니다. 모두 콜백 헬 이슈를 한 번 쯤은 겪어보았을 것이다. 이런 걱정이 점점 커지면서, 사람들은 스스로 비동기적 JavaScr">
<meta property="og:image" content="https://hyunseob.github.io/images/reactivex.png">
<meta property="og:updated_time" content="2017-01-17T15:37:08.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[번역] 반응형 프로그래밍과 RxJS 이해하기">
<meta name="twitter:description" content="요약: RxJS는 이벤트 스트림과 데이터를 쉽게 만들고 다룰 수 있도록 도우는 라이브러리다. 복잡하지만 가독성이 좋은 비동기적 코드를 더 쉽게 작성할 수 있도록 도운다.

큰 규모의 비동기 어플리케이션을 작성하는 것은 쉬운 일이 아니다. 모두 콜백 헬 이슈를 한 번 쯤은 겪어보았을 것이다. 이런 걱정이 점점 커지면서, 사람들은 스스로 비동기적 JavaScr">
<meta name="twitter:image" content="https://hyunseob.github.io/images/reactivex.png">
<meta name="twitter:creator" content="@HyunSeob_"><meta property="article:author" content="https://www.facebook.com/hyunseob.lee.7"><link rel="icon" href="/images/icon.png"><link rel="alternative" href="/atom.xml" type="application/atom+xml" title="DailyEngineering"><meta name="naver-site-verification" content="3ef8fdf091c71d652b72f4fe73b191c2246127f6"><script>(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-72857127-1', 'auto');
ga('send', 'pageview');</script></head><body itemscope itemtype="https://schema.org/WebPage"><nav id="menu" class="menu"><div class="menu-inner"><div class="menu__left-area"><div class="menu__item"><a href="/" title="Home" rel="home" class="menu__item__link menu__item__link--brand"><img src="/images/icon.png" alt="DailyEngineering" class="menu__item__link--brand__image"><span class="menu__item__link--brand__label">DailyEngineering</span></a></div></div><div class="menu__right-area"><div class="menu__item"><a href="/" class="menu__item__link">Home</a></div><div class="menu__item"><a href="/about" class="menu__item__link">About</a></div><div class="menu__item"><a href="/archives" class="menu__item__link">Archives</a></div><div class="menu__item"><a href="/resume" class="menu__item__link">Resume</a></div></div></div></nav><div class="page-background"></div><div class="content-outer"><div itemscope itemtype="https://schema.org/Blog" class="content-inner"><article id="article" itemscope itemtype="https://schema.org/BlogPosting" class="article"><h1 itemprop="headline" class="article__title">[번역] 반응형 프로그래밍과 RxJS 이해하기</h1><div class="article__meta"><time datetime="2016-10-09T14:43:48.000Z" itemprop="datePublished" class="article__meta__time">2016-10-09 23:43:48</time><div class="article__meta__categories"><a href="/categories/JavaScript/" class="article__meta__categories__item">JavaScript</a><span class="article__meta__categories__separator">></span><a href="/categories/JavaScript/RxJS/" class="article__meta__categories__item">RxJS</a></div></div><div class="article__contents"><img src="/images/reactivex.png"/><p><strong>요약</strong>: RxJS는 이벤트 스트림과 데이터를 쉽게 만들고 다룰 수 있도록 도우는 라이브러리다. 복잡하지만 가독성이 좋은 비동기적 코드를 더 쉽게 작성할 수 있도록 도운다.</p>
<hr>
<p>큰 규모의 비동기 어플리케이션을 작성하는 것은 쉬운 일이 아니다. 모두 <a href="http://callbackhell.com/" target="_blank" rel="external">콜백 헬</a> 이슈를 한 번 쯤은 겪어보았을 것이다. 이런 걱정이 점점 커지면서, 사람들은 스스로 비동기적 JavaScript 세계를 개선했다. 모두 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="external">Promise</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator" target="_blank" rel="external">Generator</a>나 <a href="https://ponyfoo.com/articles/understanding-javascript-async-await" target="_blank" rel="external">async/await</a>에 대해서 들어보았을 것이다. 또 다른 솔루션이 있다. 바로 <a href="https://github.com/Reactive-Extensions/RxJS" target="_blank" rel="external">RxJS</a>다.</p>
<p>RxJS의 GitHub README에는, RxJS는 “Observable 시퀀스와 표현력있는 쿼리 연산자를 사용하는 비동기적, 이벤트 기반의 프로그램을 구성하기 위한 라이브러리의 집합”이라고 정의되어있다. 이것은 이벤트나 데이터로부터 스트림을 만들 수 있다는 것을 뜻한다. 이 데이터를 가지고 병합(Merge)하거나, 으깨(Mash)거나, 쪼개(Split)는 등의 작업을 할 수 있다. 원하는 데이터가 있으면, 데이터를 순회하면서 무언가를 할 수 있다.</p>
<p>“Observable”이나 “스트림”의 개념은 처음에 이해하기가 어려울 수도 있다. 나는 그것들을 한 번에 한 가지만 사용하는 단일 이벤트 혹은 데이터라고 생각하기 보다는, 어떤 기간동안 다루게 되는 이벤트나 데이터의 컬렉션이라고 생각한다.</p>
<p>RxJS가 어떻게 동작하는지 보기 위해서, 간단한 날씨 어플리케이션을 작성하게 될 것이다. 우편번호를 입력하기 위한 텍스트 input이 있을 것이고, 버튼을 클릭해서 Submit하면 우편번호 위치의 현재 온도 데이터를 얻기 위한 요청이 전송될 것이다. 온도를 얻고나면, 우편번호와 온도를 함께 페이지에 표시할 것이다. 또한 페이지에 많은 온도를 넣어 계속 Watch 하도록 만들 것이다. 그리고 지정한 시간 후에 온도를 새로고침하는 타이머를 만들게 될 것이다. 이제 시작해보자!</p>
<h2 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h2><p>첫 번째로 해야할 일은 RxJS 라이브러리를 로드하고 사용할 수 있는 기본적인 HTML 페이지를 만드는 것이다. 또한 약간의 CSS도 포함할 것이다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"ko"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Weather Monitoring in RxJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">  #form &#123;</div><div class="line">    margin-bottom: 20px;</div><div class="line">  &#125;</div><div class="line">  .location &#123;</div><div class="line">    float: left;</div><div class="line">    padding: 10px;</div><div class="line">    margin-right: 20px;</div><div class="line">    margin-bottom: 20px;</div><div class="line">    border: 1px solid #ddd;</div><div class="line">    border-radius: 5px;</div><div class="line">  &#125;</div><div class="line">  .location p &#123;</div><div class="line">    margin-top: 10px;</div><div class="line">    margin-bottom: 10px;</div><div class="line">    text-align: center;</div><div class="line">  &#125;</div><div class="line">  .zip &#123; font-size: 2em; &#125;</div><div class="line">  .temp &#123; font-size: 4em; &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app-container"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"form"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>Zip Code:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"zipcode-input"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"add-location"</span>&gt;</span>Add Location<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/rxjs/4.1.0/rx.all.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="comment">// our code will go here</span></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'RxJS included?'</span>, !!Rx);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>이 파일을 선호하는 브라우저에서 열고, 개발자 콘솔창을 열어보자. <code>RxJS included? true</code> 라는 문장이 나타났는가? 그렇다면 이제 반응형 JavaScript를 작성할 준비가 끝난 것이다! 우편번호를 넣는 <code>&lt;input&gt;</code>과 <code>&lt;button&gt;</code>을 포함하는 간단한 “form”이 있다는 것을 확인하라. 첫 번째 JavaScript 코드는 이 element들의 이벤트로부터 스트림을 만드는 게 될 것이다. 또한 나중에 element들을 추가할 수 있도록 <code>app-container</code>의 참조도 얻을 것이다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Grab HTML elements</span></div><div class="line"><span class="keyword">const</span> appContainer = <span class="built_in">document</span>.getElementById(<span class="string">'app-container'</span>);</div><div class="line"><span class="keyword">const</span> zipcodeInput = <span class="built_in">document</span>.getElementById(<span class="string">'zipcode-input'</span>);</div><div class="line"><span class="keyword">const</span> addLocationBtn = <span class="built_in">document</span>.getElementById(<span class="string">'add-location'</span>);</div></pre></td></tr></table></figure>
<p>평범한 JavaScript 코드다. 별로 특별한 것은 없다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Get stream of button clicks</span></div><div class="line"><span class="keyword">const</span> btnClickStream =</div><div class="line">  Rx.Observable</div><div class="line">    .fromEvent(addLocationBtn, <span class="string">'click'</span>)</div><div class="line">    .map(<span class="function"><span class="params">()</span> =&gt;</span> <span class="literal">true</span>)</div><div class="line">    .forEach(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'btnClickStream val'</span>, val));</div></pre></td></tr></table></figure>
<p>드디어 첫 번째로 RxJS 코드를 작성한다! <code>Rx.Observable</code> 객체의 <code>fromEvent</code> 메소드를 사용하여 <code>addLocationBtn</code>으로부터 발생하는 클릭 이벤트로부터 스트림을 만들었다. 이것은 언제든 버튼이 클릭될 떄마다, 이벤트 객체가 <code>btnClickStream</code>으로 전송된다는 것을 의미한다. 반환된 스트림의 각 값을 <code>true</code>로 매핑하기 위해서 <code>map</code> 메소드를 사용했다. 나는 내 머릿속에 있는 로직을 단순화하는 것을 좋아한다. 이벤트가 일어났는지만 확인하면 되기 때문에 값을 간단한 boolean 값으로 매핑했다. 이것은 그냥 내가 좋아하는 방식이다. 만약 당신의 취향과 맞지 않는다면 지워져도 상관없는 코드다. 마지막으로, 이벤트가 동작하는 지 확인하기 위해서 스트림의 구독자(subscriber)를 추가하는 <code>forEach</code>를 사용한다. 이것이 간단하게 값을 로깅(logging)하는 코드다.</p>
<p><img src="/images/understanding-rx/btn_click_stream.png" alt="버튼 클릭 스트림"></p>
<p>페이지를 새로고침하고, 버튼을 몇 번 클릭해보면 개발자 콘솔에 출력 결과가 보일 것이다. 정상적으로 동작한다! 이제 버튼 스트림에서 <code>forEach</code>를 제거하자. 필요하지 않은 코드다. 이제 우편번호를 얻을 차례다. 우편번호 input에 입력된 문자열의 길이가 5일 때만 이벤트를 수신하고 싶다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Get stream of zip codes</span></div><div class="line"><span class="keyword">const</span> zipInputStream =</div><div class="line">  Rx.Observable</div><div class="line">    .fromEvent(zipcodeInput, <span class="string">'input'</span>)</div><div class="line">    .map(<span class="function"><span class="params">e</span> =&gt;</span> e.target.value)</div><div class="line">    .filter(<span class="function"><span class="params">zip</span> =&gt;</span> zip.length === <span class="number">5</span>)</div><div class="line">    .forEach(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'zipInputStream val'</span>, val));</div></pre></td></tr></table></figure>
<p>input 요소로부터 발생한 이벤트로 스트림을 만들었다. input 이벤트로부터 값을 추출하기 위해서 <code>map</code>을 사용한다. 그리고 문자열의 길이가 5가 아닌 값들을 제거하기 위해서 <code>filter</code>를 사용한다. <code>filter</code>는 지정된 조건식이 <code>true</code>를 반환하는 경우 해당 값을 반환되는 스트림에 포함시킨다. 마지막으로, 다시 각 값을 순회하면서 콘솔에 로그를 남긴다.</p>
<p><img src="/images/understanding-rx/zip_input_stream.png" alt="우편번호 입력 스트림"></p>
<p>페이지를 새로고침하고 뭔가를 입력해보면, 입력된 문자열의 길이가 5일 때만 값을 확인할 수 있다는 사실을 알 수 있다. 잘하고 있다. <code>forEach</code>를 제거하자. 이제 유저가 버튼을 클릭했을 때만 input에 있는 값을 전달하도록 만들 것이다. 이를 위한 새로운 스트림을 만들어보자!</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Get zipcode after button clicked</span></div><div class="line"><span class="keyword">const</span> zipcodeStream =</div><div class="line">  btnClickStream</div><div class="line">    .withLatestFrom(zipInputStream, (click, zip) =&gt; zip)</div><div class="line">    .distinct()</div><div class="line">    .forEach(<span class="function"><span class="params">val</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'zipcodeStream val'</span>, val));</div></pre></td></tr></table></figure>
<p><code>btnClickStream</code>의 <code>withLatestFrom</code>을 호출하여 <code>zipInputStream</code>을 넘겼다. 이것은 <code>btnClickStream</code>의 값이 보일때마다 <code>zipInputStream</code>의 가장 최근 값을 얻고 <code>map</code>처럼 동작하는 함수인 “result selector”로 전달하는 것을 의미한다. 이 함수에서 반환된 값은 <code>withLatestFrom</code>으로부터 반환된 스트림에 전달된다. 다음으로, 새로운 값만을 얻기 위해 <code>distinct</code> 메소드를 사용한다. 중복된 값이 존재한다면, 그 값은 <code>distinct</code>로 인해 반환된 스트림에는 전달되지 않는다. 그리고 당연하지만, 제대로 동작하는지 확인하기 위해서 로그를 <code>forEach</code>를 사용해 출력하였다.</p>
<p><img src="/images/understanding-rx/zip_stream.png" alt="우편번호 스트림"></p>
<p>페이지를 새로고침하고, 우편번호를 입력한 후에 버튼을 클릭해보자. 개발자 콘솔을 보면, 버튼이 클릭될 때 우편번호가 스트림으로 submit 되는 것을 확인할 수 있다. 이제, 아까 했던 것처럼, <code>forEach</code> 문을 제거한다. 우편번호가 추가되거나 타이머의 시간이 지날 때마다 호출할 재사용성 높은 날씨 API가 필요하다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Create reusable temperature fetching stream</span></div><div class="line"><span class="keyword">const</span> getTemperature = <span class="function"><span class="params">zip</span> =&gt;</span></div><div class="line">  fetch(<span class="string">`http://api.openweathermap.org/data/2.5/weather?q=<span class="subst">$&#123;zip&#125;</span>,us&amp;units=imperial&amp;appid=APPID`</span>)</div><div class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json());</div><div class="line"></div><div class="line"><span class="keyword">const</span> zipTemperatureStreamFactory = <span class="function"><span class="params">zip</span> =&gt;</span></div><div class="line">  Rx.Observable</div><div class="line">    .fromPromise(getTemperature(zip))</div><div class="line">    .map(<span class="function">(<span class="params">&#123; main: &#123; temp &#125; &#125;</span>) =&gt;</span> (&#123; temp, zip &#125;));</div></pre></td></tr></table></figure>
<p>두 개의 함수를 제작하였다. 첫 번째 함수, <code>getTemperature</code>는 우편번호를 받아 날씨 API에서 온도를 받아오는 요청을 만든다. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="external"><code>fetch</code></a>가 Promise를 반환하므로, Promise에 있는 메소드인 <code>then</code>을 호출할 수 있다. 이 Promise는 응답을 받아 더욱 쉽게 활용할 수 있는 JSON 포맷을 리턴한다. 이것은 이 함수가 Promise를 반환한다는 것을 의미한다. 이건 중요하다. 또한, <code>APPID</code>를 <a href="https://home.openweathermap.org/api_keys" target="_blank" rel="external">OpenWeatherMap 관리자 페이지에서 받을 수 있는 무료 API 키</a>로 변경하는 걸 잊지마시기 바란다.</p>
<p>두 번째 함수는 우편번호를 받는다. <code>Rx.Observable</code>의 <code>fromPromise</code> 메소드를 사용하여 <code>getTemperature</code> 함수에서 반환된 Promise로 스트림을 생성한다. 이것은 스트림을 반환하기 때문에, <code>Rx.Observable</code> 인스턴스가 가지는 메소드를 모두 사용할 수 있다. 현재 우편번호와 온도에만 관심이 있기 때문에, 해당 정보만 보유하는 객체를 반환하도록 하자. Promise 스트림에 <code>map</code>을 사용하여 입력을 destructuring하여 온도를 출력하고, 원하는 데이터를 포함하는 객체를 반환한다. ES2015의 새로운 destructuring 문법에 대한 더 많은 정보는 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="external">MDN을 참고하시기 바란다</a>.</p>
<p>이제 날씨 API로부터 데이터를 얻는 함수가 완성되었다. 마지막으로 페이지에 element를 추가하도록 하자.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Get new zip at each button click, get its</span></div><div class="line"><span class="comment">// temperature, and paint it to the screen</span></div><div class="line">zipcodeStream</div><div class="line">  .flatMap(zipTemperatureStreamFactory)</div><div class="line">  .forEach(<span class="function">(<span class="params">&#123; zip, temp &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">const</span> locationEle = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">    locationEle.id = <span class="string">`zip-<span class="subst">$&#123;zip&#125;</span>`</span>;</div><div class="line">    locationEle.classList.add(<span class="string">'location'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> zipEle = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</div><div class="line">    zipEle.classList.add(<span class="string">'zip'</span>);</div><div class="line">    zipEle.innerText = zip;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> tempEle = <span class="built_in">document</span>.createElement(<span class="string">'p'</span>);</div><div class="line">    tempEle.classList.add(<span class="string">'temp'</span>);</div><div class="line">    tempEle.innerHTML = <span class="string">`<span class="subst">$&#123;temp&#125;</span>&amp;deg;F`</span>;</div><div class="line"></div><div class="line">    locationEle.appendChild(zipEle);</div><div class="line">    locationEle.appendChild(tempEle);</div><div class="line">    appContainer.appendChild(locationEle);</div><div class="line"></div><div class="line">    zipcodeInput.value = <span class="string">''</span>;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<p>이제 우편번호 스트림의 <code>flatMap</code> 메소드를 호출한다. <code>flatMap</code>은 스트림으로 만들어진 스트림을 인자로 받아 각 스트림으로부터 값을 얻고 스트림으로 반환하여 사용가능하게 한다는 점만 제외한다면 일반 <code>map</code>처럼 동작한다. 즉, 날씨 API로의 요청으로부터 만들어진 스트림들을 납작하게(flatten) 만들고 스트림으로부터 얻어지는 값인 우편번호와 온도를 가지는 객체를 제공하는 메소드이다.</p>
<p>마지막 파트에서는 <code>forEach</code>를 사용하여 각 데이터를 얻고, 페이지에 추가한다. 콜백 함수 내에 있는 모든 코드는 순수한 JavaScript로 이루어져 있다. element를 구성하고 페이지에 추가한다. 그리고 <code>zipcodeInput</code>의 값을 비워준다.</p>
<p><img src="/images/understanding-rx/initial_add_to_page.png" alt="페이지에 요소가 추가된 모습"></p>
<p>페이지를 새로고침하고 우편번호를 몇 개 입력해보자. 페이지에 우편번호와 온도가 포함된 새로운 element가 추가된 것을 볼 수 있을 것이다.</p>
<p>이제 페이지에 온도가 표시되기 시작했으니, 이제 그것들을 업데이트 할 수 있는지 확인해보자. 지정한 시간마다 값을 출력하는 스트림은 만들 수 있다. 그러나, 입력한 모든 우편번호를 얻을 수 있는지 확인해 봐야한다. 이를 위해, <code>ReplaySubject</code>를 사용할 수 있다. <code>ReplaySubject</code>는 스트림을 구독하고 스트림으로부터 받은 모든 값을 기억한다. 그리고 그것을 원할 때마다 반복할 수 있다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Create stream that can replay all zips at will</span></div><div class="line"><span class="keyword">const</span> replayZipsStream = <span class="keyword">new</span> Rx.ReplaySubject();</div><div class="line">zipcodeStream.subscribe(replayZipsStream);</div></pre></td></tr></table></figure>
<p>새로운 <code>ReplaySubject</code>를 만들고 <code>zipcodeStream</code>을 구독했다. 이것은 <code>ReplaySubject</code>가 입력하는 모든 우편번호를 기억할 것이라는 것이다. 한 번 사용해보자!</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// Create a timer to refresh the data</span></div><div class="line"><span class="comment">// and update the page</span></div><div class="line">Rx.Observable</div><div class="line">  .interval(<span class="number">20000</span>)</div><div class="line">  .flatMapLatest(<span class="function"><span class="params">()</span> =&gt;</span> replayZipsStream)</div><div class="line">  .flatMap(zipTemperatureStreamFactory)</div><div class="line">  .forEach(<span class="function">(<span class="params">&#123; zip, temp &#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Updating!'</span>, zip, temp);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> locationEle = <span class="built_in">document</span>.getElementById(<span class="string">`zip-<span class="subst">$&#123;zip&#125;</span>`</span>);</div><div class="line">    <span class="keyword">const</span> tempEle = locationEle.querySelector(<span class="string">'.temp'</span>);</div><div class="line"></div><div class="line">    tempEle.innerHTML = <span class="string">`<span class="subst">$&#123;temp&#125;</span>&amp;deg;F`</span>;</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<p>첫 번째로 해야할 일은 지정한 시간마다 값을 출력하는 스트림을 만드는 것이다. 그 값은 신경쓸 부분이 아니다. 단지 그 값이 출력되는 시간이 필요한 것이다. 그리고 <code>ReplaySubject</code>인 콜백 함수로부터 얻을 수 있는 스트림을 납작하게 하기 위해서 새로운 메소드인 <code>flatMapLatest</code>를 사용한다. <code>flatMap</code> 대신에 <code>flatMapLatest</code>를 사용하는 이유는 <code>replayZipsStream</code>이 단 하나의 구독자만 가지는 것을 보장하고 싶기 때문이다. 그냥 <code>flatMap</code>을 사용했다면 같은 <code>ReplaySubject</code>에 여러 개의 구독자를 추가했을 것이고, 그렇게 되면 날씨 API로 쓸데 없는 여러 개의 요청을 날리게 될 것이다. 어쨌든 페이지에 추가했던 우편번호 스트림을 얻었을 것이다. 이제 이것을 같은 방식으로 사용할 수 있다. <code>flatMap</code>을 사용하여 날씨 API로 보내는 요청을 만드는 팩토리 함수에 통과시키도록 하자. 마지막으로, 그것들을 모두 순회하면서 각각 응답을 받아 페이지에 있는 데이터를 업데이트 하면 된다.</p>
<p><img src="/images/understanding-rx/timer_stream.png" alt="타이머 스트림"></p>
<p>마지막으로 페이지를 새로고침 한 뒤에, 몇 개의 우편번호를 추가해보자. 정상적으로 페이지에 추가된 것을 볼 수 있을 것이다. 20초를 기다리면 개발자 콘솔에 값이 업데이트 되었다는 메시지를 볼 수 있을 것이다. 20초 동안 온도 변화가 없다면, 페이지에는 아무 변화도 없을 수 있다. 더 자주 혹은 뜸하게 시간 간격을 주고 싶다면, 필요에 알맞게 <code>Rx.Observable.interval</code>에 넘기는 값을 변경하면 된다.</p>
<h2 id="Auth0-Lock과-함께-쓰기1"><a href="#Auth0-Lock과-함께-쓰기1" class="headerlink" title="Auth0 Lock과 함께 쓰기1"></a>Auth0 Lock과 함께 쓰기<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></h2><p>이제 당신은 스트림을 제대로 쓸 수 있게 되었다. 그런데 날씨 어플리케이션의 인증 솔루션으로 <a href="https://auth0.com/lock" target="_blank" rel="external">Auth0 Lock</a>을 쓰고 싶을 수 있다. 어떻게 구현하면 될까? 뭐, 매우 간단하다. 대부분의 일은 라이브러리에 의해 처리된다. 그냥 버튼을 클릭했을 때 Lock 모달이 나오는 것만 확실하게 하면 된다. 한 번 해보자!</p>
<p>먼저, 라이브러리를 포함한 다음, Lock을 초기화 하고, 모달을 띄울 로그인 버튼을 추가하자.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"login"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdn.auth0.com/js/lock/10.x.y/lock.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="comment">// Initiating our Auth0Lock</span></div><div class="line">    <span class="keyword">var</span> lock = <span class="keyword">new</span> Auth0Lock(</div><div class="line">      <span class="string">'YOUR_CLIENT_ID'</span>,</div><div class="line">      <span class="string">'YOUR_NAMESPACE'</span></div><div class="line">    );</div><div class="line"></div><div class="line">    <span class="comment">// Listening for the authenticated event</span></div><div class="line">    lock.on(<span class="string">"authenticated"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">authResult</span>) </span>&#123;</div><div class="line">      <span class="comment">// Use the token in authResult to getProfile() and save it to localStorage</span></div><div class="line">      lock.getProfile(authResult.idToken, <span class="function"><span class="keyword">function</span>(<span class="params">error, profile</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (error) &#123;</div><div class="line">          <span class="comment">// Handle error</span></div><div class="line">          <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        localStorage.setItem(<span class="string">'idToken'</span>, authResult.idToken);</div><div class="line">        localStorage.setItem(<span class="string">'profile'</span>, <span class="built_in">JSON</span>.stringify(profile));</div><div class="line">      &#125;);</div><div class="line">    &#125;);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>마지막으로 남은 일은 버튼 이벤트를 스트림으로 전환하고, 그 스트림에서 데이터를 받을 때마다 모달을 여는 것이다.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">Rx.Observable</div><div class="line">  .fromEvent(<span class="built_in">document</span>.getElementById(<span class="string">'login'</span>), <span class="string">'click'</span>)</div><div class="line">  .forEach(<span class="function"><span class="params">()</span> =&gt;</span> lock.open());</div></pre></td></tr></table></figure>
<p>이렇게 완료됐다.</p>
<h2 id="Gotta-Stream-Them-All"><a href="#Gotta-Stream-Them-All" class="headerlink" title="Gotta Stream Them All"></a>Gotta Stream Them All</h2><p>Observable 혹은 스트림이라는 용어는 처음엔 약간 생소하게 느껴질 수 있다. 내가 접근했던 방법은 싱글 이벤트라는 생각 대신 일정 시간 동안의 이벤트 컬렉션이라고 생각하는 것이었다. 이렇게 하면 DOM으로부터 발생하는 모든 이벤트를 스트림으로 생각하는 것은 식은 죽 먹기일 것이다. RxJS는 쉽게 이벤트로부터 스트림을 만들고 상호작용할 수 있도록 돕는다. RxJS는 어플리케이션 로직을 유지하고, 다른 프레임워크 혹은 라이브러리를 사용할 떄보다 코드를 쉽게 만들어주는 강력한 방법이다. 늘 그렇듯이 코멘트 달아주시고 얼마나 RxJS를 좋아하는지 알려주시기 바란다.</p>
<p><a href="https://auth0.com/blog/understanding-reactive-programming-and-rxjs/" target="_blank" rel="external">[ 원문 보기 ]</a></p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;"><strong>역자 주</strong>: 이 쪽은 광고문단에 가까우니 참고.</span><a href="#fnref:1" rev="footnote"> ↩</a></li></ol></div></div></div><div class="article__tags"><a href="/tags/Translate/" class="article__tags__item">Translate</a><a href="/tags/Tutorial/" class="article__tags__item">Tutorial</a><a href="/tags/ReactiveX/" class="article__tags__item">ReactiveX</a><a href="/tags/RxJS/" class="article__tags__item">RxJS</a></div><div itemscope itemprop="author" itemtype="https://schema.org/Person" class="article__author"><img src="/images/avatar.jpg" alt="HyunSeob" class="article__author__image"><a href="/resume" title="About HyunSeob" rel="author" class="article__author__link">HyunSeob</a><p class="article__author__desc">JavaScript 모지리</p><div class="article__author__socials"><a href="https://github.com/hyunseob" title="github" target="_blank" class="article__author__socials__item"><i class="fa fa-github"></i></a><a href="https://www.facebook.com/hyunseob.lee.7" title="facebook" target="_blank" class="article__author__socials__item"><i class="fa fa-facebook"></i></a><a href="https://www.linkedin.com/in/hyunseoblee" title="linkedin" target="_blank" class="article__author__socials__item"><i class="fa fa-linkedin"></i></a><a href="https://www.instagram.com/hyunseob_lee/" title="instagram" target="_blank" class="article__author__socials__item"><i class="fa fa-instagram"></i></a><a href="https://twitter.com/HyunSeob_" title="twitter" target="_blank" class="article__author__socials__item"><i class="fa fa-twitter"></i></a><a href="/atom.xml" title="rss" target="_blank" class="article__author__socials__item"><i class="fa fa-rss"></i></a></div><meta itemprop="name" content="HyunSeob"></div><div id="sharer" class="sharer"><div class="sharer-inner"><div class="sharer__right"><button id="sharer-facebook" class="sharer__item"><i class="fa fa-facebook-official"></i></button><button id="sharer-twitter" class="sharer__item"><i class="fa fa-twitter"></i></button><button id="sharer-pinterest" class="sharer__item"><i class="fa fa-pinterest"></i></button><button id="sharer-pocket" class="sharer__item"><i class="fa fa-get-pocket"></i></button></div></div></div><!-- Disqus Code--><div id="disqus_thread"></div><script>(function() {
  var d = document, s = d.createElement('script');
  s.src = '//dailyengineering.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Enable JavaScript to see comments.</noscript><!-- Meta Tags for Structured Data--><meta itemprop="dateModified" content="2017-01-17T15:37:08.000Z"><meta itemprop="articleBody" content="요약: RxJS는 이벤트 스트림과 데이터를 쉽게 만들고 다룰 수 있도록 도우는 라이브러리다. 복잡하지만 가독성이 좋은 비동기적 코드를 더 쉽게 작성할 수 있도록 도운다.

큰 규모의 비동기 어플리케이션을 작성하는 것은 쉬운 일이 아니다. 모두 콜백 헬 이슈를 한 번 쯤은 겪어보았을 것이다. 이런 걱정이 점점 커지면서, 사람들은 스스로 비동기적..."><meta itemprop="url" content="https://hyunseob.github.io/2016/10/09/understanding-reactive-programming-and-rxjs/"><meta itemprop="mainEntityOfPage" content="https://hyunseob.github.io/2016/10/09/understanding-reactive-programming-and-rxjs/"><div itemscope itemtype="https://schema.org/Organization" itemprop="publisher"><meta itemprop="name" content="DailyEngineering"><div itemscope itemprop="logo" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://hyunseob.github.io/images/icon.png"></div></div><div itemscope itemtype="https://schema.org/ImageObject" itemprop="image"><meta itemprop="contentUrl" content="https://hyunseob.github.io/images/reactivex.png"><meta itemprop="url" content="https://hyunseob.github.io/images/reactivex.png"><meta itemprop="width" content="1200"><meta itemprop="height" content="630"></div></article><section class="related-posts"><h3>Related posts</h3><div class="related-posts__item__wrapper"><a href="/2016/04/10/introduction-to-angularjs-style-guide/" class="related-posts__item"><div style="background-image: url('/images/angularjs.png')" class="related-posts__item__background"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">[번역] AngularJS 스타일 가이드 소개</span></a></div><div class="related-posts__item__wrapper"><a href="/2016/03/27/usage-of-sequelize-js/" class="related-posts__item"><div style="background-image: url('/images/sequelizejs.png')" class="related-posts__item__background"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Sequelize.js 다루기</span></a></div><div class="related-posts__item__wrapper"><a href="/2016/02/23/start-hexo/" class="related-posts__item"><div style="background-image: url('/images/default.jpg')" class="related-posts__item__background"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Hexo 시작하기</span></a></div></section></div></div><footer id="footer"><div class="widgets"><div class="widgets-inner"><!-- Jade doesn't support dynamic inclusion with `each`.--><!-- So, I just hard coded the file names that will be included.--><div class="widgets__item"><h3 class="widgets__item__heading">Recent posts</h3><ul class="recent-posts"><li class="recent-posts__item"><a href="/2017/01/14/typescript-generic/">TypeScript: 제네릭(Generic)</a></li><li class="recent-posts__item"><a href="/2017/01/09/solved-by-flexbox/">Flexbox 활용사례 모음: Solved by Flexbox</a></li><li class="recent-posts__item"><a href="/2016/12/10/a-look-back-on-blog-in-2016/">2016년 블로그 운영 회고</a></li><li class="recent-posts__item"><a href="/2016/12/05/book-functional-thinking/">[책] 함수형 사고</a></li><li class="recent-posts__item"><a href="/2016/11/21/misunderstanding-about-const/">const에 대한 오해</a></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Tag cloud</h3><div class="tag-cloud"><a href="/tags/Angular2/" style="font-size: 0.75rem;">Angular2</a> <a href="/tags/AngularJS/" style="font-size: 1.2rem;">AngularJS</a> <a href="/tags/Attitude/" style="font-size: 0.75rem;">Attitude</a> <a href="/tags/Blog/" style="font-size: 0.9rem;">Blog</a> <a href="/tags/Build/" style="font-size: 0.75rem;">Build</a> <a href="/tags/CSS/" style="font-size: 0.75rem;">CSS</a> <a href="/tags/Closure/" style="font-size: 0.9rem;">Closure</a> <a href="/tags/CoffeeScript/" style="font-size: 0.9rem;">CoffeeScript</a> <a href="/tags/ComputerScience/" style="font-size: 0.75rem;">ComputerScience</a> <a href="/tags/DOM/" style="font-size: 0.9rem;">DOM</a> <a href="/tags/DesignPattern/" style="font-size: 0.75rem;">DesignPattern</a> <a href="/tags/Deview/" style="font-size: 0.75rem;">Deview</a> <a href="/tags/ES2015/" style="font-size: 1.2rem;">ES2015</a> <a href="/tags/ESLint/" style="font-size: 0.75rem;">ESLint</a> <a href="/tags/Electron/" style="font-size: 0.75rem;">Electron</a> <a href="/tags/Functional/" style="font-size: 0.75rem;">Functional</a> <a href="/tags/GraphQL/" style="font-size: 0.75rem;">GraphQL</a> <a href="/tags/Hexo/" style="font-size: 0.75rem;">Hexo</a> <a href="/tags/JavaScript/" style="font-size: 1.5rem;">JavaScript</a> <a href="/tags/Log/" style="font-size: 0.9rem;">Log</a> <a href="/tags/Node-js/" style="font-size: 1.05rem;">Node.js</a> <a href="/tags/ORM/" style="font-size: 0.75rem;">ORM</a> <a href="/tags/Opinion/" style="font-size: 0.75rem;">Opinion</a> <a href="/tags/Promise/" style="font-size: 0.75rem;">Promise</a> <a href="/tags/Q-js/" style="font-size: 0.75rem;">Q.js</a> <a href="/tags/React/" style="font-size: 0.75rem;">React</a> <a href="/tags/ReactiveX/" style="font-size: 0.75rem;">ReactiveX</a> <a href="/tags/RxJS/" style="font-size: 0.75rem;">RxJS</a> <a href="/tags/Sequelize-js/" style="font-size: 0.75rem;">Sequelize.js</a> <a href="/tags/Terminology/" style="font-size: 0.75rem;">Terminology</a> <a href="/tags/Testing/" style="font-size: 0.75rem;">Testing</a> <a href="/tags/Translate/" style="font-size: 1.2rem;">Translate</a> <a href="/tags/Tutorial/" style="font-size: 1.2rem;">Tutorial</a> <a href="/tags/TypeScript/" style="font-size: 1.35rem;">TypeScript</a> <a href="/tags/babel/" style="font-size: 0.75rem;">babel</a> <a href="/tags/jQuery/" style="font-size: 1.05rem;">jQuery</a> <a href="/tags/lodash/" style="font-size: 0.9rem;">lodash</a> <a href="/tags/underscore-js/" style="font-size: 1.05rem;">underscore.js</a> <a href="/tags/webpack/" style="font-size: 0.75rem;">webpack</a></div></div><div class="widgets__item"><h3 class="widgets__item__heading">Categories</h3><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Book/">Book</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ComputerScience/">ComputerScience</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/">FrontEnd</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">21</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/AngularJS/">AngularJS</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/Basic/">Basic</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/DesignPattern/">DesignPattern</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/ES2015/">ES2015</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/RxJS/">RxJS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/TypeScript/">TypeScript</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/lodash-underscore/">lodash/underscore</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Opinion/">Opinion</a><span class="category-list-count">2</span></li></ul></div></div></div><p class="copyright"><small>© 2017 HyunSeob<br>Powered by <a href="https://hexo.io" rel="external" target="_blank">Hexo</a>, Theme by <a href="https://github.com/hyunseob" rel="external" target="_blank">HyunSeob</a></small></p></footer><!--[if lt IE 10]><script src="/js/classList.min.js"></script><![endif]--><script src="/js/index.min.js"></script></body></html>